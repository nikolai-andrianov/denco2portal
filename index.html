<!DOCTYPE html>
<html lang="en">
<head>
	
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	
	<title>Denmark's CO2 Portal - Home</title>
	
	<!-- Add Leaflet classes -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

	<!-- Add the left menu pane -->
	<script src="scripts/L.Control.Pane.js"></script>

	<!-- Add Bootstrap UI 	-->	 
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<style>

		/* Change the html body to be a grid with 3 rows */
		body {
		  margin: 0;
		  height: 100vh;
		  display: grid;
		  grid-template-columns: 1fr;
		  grid-template-rows   : 75px 1fr 75px;
		  grid-template-areas: 
			"hd" 
			"cn" 
			"ft";
		  gap: 3px;
		}

		.header {
		  grid-area: hd;
		  z-index: 100;
		}

		.center {
		  grid-area: cn;
		  z-index: 0;
		}

		.footer {
		  grid-area: ft;
		}
		
		.create-well-dialog {
		  display: grid;
		  grid-template-columns: auto fit-content(2px) auto;
		  padding: 0px;
		}
		.well-item {
		  padding-inline: 5px; /* Horizontal */
		  padding-block: 5px; /* Vertical */
		}
		
	</style>
	
</head> 

<body>
	
	<!-- Coordinates of the structures 	-->	
	<script src="./structures/stenlille_structure.js"></script>
	<script src="./structures/havnsoe_structure.js"></script>
	<script src="./structures/gassum_structure.js"></script>
	<script src="./structures/thorning_structure.js"></script>
	<script src="./structures/roedby_structure.js"></script>	
	<script src="./structures/lisa_structure.js"></script>
	<script src="./structures/inez_structure.js"></script>						
	<script src="./structures/jammerbugt_structure.js"></script>		

	<!-- Header 		-->	
	<script src="./header.js"></script>	
	
	<!-- The central visualization area -->
	<div id="map" class="center">
	<div class="container">	
	</div>
	</div>
	
	<script>
	
		// Create a map without the default zoom
		// Set view to see all structures
		const map = L.map('map', {zoomControl: false}).setView([55.909194, 10.255737], 7);
		
		// Create the zoom in the top-right corner
		L.control.zoom({position: 'topright'}).addTo(map);

		// OSM layer 
		const osmLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			});
			
		// Add scale
		L.control.scale({imperial: false, position: 'topright'}).addTo(map); 

		// Bounding box for the top and base Gassum maps
		// Converted from the EPSG:3857 projected coordinates 870199.7523 7255482.7536
		let sw = [54.448104, 7.8171374];
		// Converted from the projected coordinates 1447428.6961 7929078.864
		let ne = [57.817507, 13.002473];				
		let latLngBounds = L.latLngBounds([sw, ne]);
		
		// Define the layers for top and base Gassum maps
		let gassumTopMap = "./layers/gassum_top.png";	
		let gassumBaseMap = "./layers/gassum_base.png";	
		
		let gassumTopLayer = L.imageOverlay(gassumTopMap, latLngBounds, {
					opacity: 0.7,
					interactive: true
				});
		let gassumBaseLayer = L.imageOverlay(gassumBaseMap, latLngBounds, {
					opacity: 0.7,
					interactive: true
				});	

		// Define the structures' contours
		// For Stenlille, open the project; for others - just a popup		
		let structures = [L.polygon(stenlille).on('click', function(evt) { window.open("./project.html") }),
						  L.polygon(havnsoe).bindPopup('Havnsø'),
						  L.polygon(gassum).bindPopup('Gassum'),		
						  L.polygon(thorning).bindPopup('Thorning'),
						  L.polygon(roedby).bindPopup('Rødby'),
						  L.polygon(lisa).bindPopup('Lisa'),
					      L.polygon(inez).bindPopup('Inez'),
					      L.polygon(jammerbugt).bindPopup('Jammerbugt')
						  ];
		
		// Color the structures with red
		for (s = 0; s < structures.length; s++) structures[s].setStyle({color: "red"});
			
		// Define the layer with the structures
		let structuresLayer = L.layerGroup(structures);
		
		var checked = true;
		const inputLayers = {
			"Map": [osmLayer, checked],
			"Top Gassum": [gassumTopLayer, !checked],
			"Base Gassum": [gassumBaseLayer, !checked],
			"Structures": [structuresLayer, checked],
		};

		// Add the left menu pane
		L.control
			.pane(inputLayers, {
				label: "Layers",
				collapsed: false,
			})
			.addTo(map);
			

		// Add mouse click event listeners
		/*
		function onLeftClick(e) {
			L.popup()
				.setLatLng(e.latlng)
				.setContent(`${e.latlng.toString()}`)
				.openOn(map);
		}	
		map.on('click', onLeftClick);	
		*/		
		
		/*
		decimal
		places	degrees		distance
		0		1.0			111 km
		1		0.1			11.1 km
		2		0.01		1.11 km
		3		0.001		111 m
		4		0.0001		11.1 m
		5		0.00001		1.11 m
		*/
		// A template for the New well creation dialog		
		// Input box maxlength does not work for type="number"		
		let newWellSpecs = '<b>Create a vertical injection well</b> \
							<hr>  \
							<div class="create-well-dialog"> \
							<div class="well-item">Latitude</div><div class="well-item"><input id="idWellLat" type="text" value="0" maxlength="5" size="5"/></div><div class="well-item">deg</div> \
							<div class="well-item">Longitude</div><div class="well-item"><input id="idWellLng" type="text" value="0" maxlength="5" size="5"/></div><div class="well-item">deg</div> \
							<div class="well-item">Top completion</div><div class="well-item"><input id="idTopComp" type="text" value="0" maxlength="5" size="5"/></div><div class="well-item">m</div> \
							<div class="well-item">Bottom completion</div><div class="well-item"><input id="idBottomComp" type="text" value="0" maxlength="5" size="5"/></div><div class="well-item">m</div> \
							<div class="well-item">CO<sub>2</sub> injection rate</div><div class="well-item"><input id="idCO2injRate" type="text" value="0" maxlength="5" size="5"/></div><div class="well-item">Mta</div> \
							<div class="well-item"></div><div class="well-item"></div><div class="well-item"></div> \
							<div class="well-item"><button onclick="newWellDialog.close()">Ok</button></div> \
							<div class="well-item"></div> \
							<div class="well-item"><button onclick="newWellDialog.close()">Cancel</button></div> \
							</div> <br> \
							'		
					
		var newWellDialog = L.popup({
			closeButton: false,
			autoClose: false,
			closeOnClick: false,
			closeOnEscapeKey: false
		})
		.setContent(newWellSpecs);
		
		
		function onRightClick(e) {
				
			// Allow for just one dialog at a time
			if (!newWellDialog.isOpen()) {
				// Create the well dialog with dummy (0, 0) values in in the input boxes
				newWellDialog
					.setLatLng(e.latlng)
					.openOn(map);
					
			// Update the values in the input boxes 
			// Round to 5 decimal places, which correspond to the accuracy of 1.11 m
			document.getElementById('idWellLat').value = Math.round(e.latlng.lat * 1e5) / 1e5;
			document.getElementById('idWellLng').value = Math.round(e.latlng.lng * 1e5) / 1e5;
				
			}

		}	
		map.on('contextmenu', onRightClick);
		
		
	</script>	

	
	<!-- Footer 	-->
	<script src="./footer.js"></script>

	

</body>
</html>
